!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=15)}([function(t,e){t.exports=require("typedi")},function(t,e,r){"use strict";r(3);var n=r(2);r.d(e,"d",function(){return n.d}),r.d(e,"c",function(){return n.c}),r.d(e,"b",function(){return n.b}),r.d(e,"a",function(){return n.a})},function(t,e,r){"use strict";r(3);var n=r(5),o=r(0),i=function(t,e,r,n){var o,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(e,r,c):o(e,r))||c);return i>3&&c&&Object.defineProperty(e,r,c),c},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=function(){function t(){this.logger=Object(n.createLogger)({format:n.format.combine(n.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),Object(n.format)(function(t){return"error"===t.level?Object.assign({},t,{message:t.timestamp+" "+t.stack}):t})(),n.format.printf(function(t){var e=t.timestamp,r=t.level,n=t.message,o=t.meta;return o?e+" "+r+" ["+o.filename+":"+o.line+"]: "+n:e+" "+r+" "+n})),transports:[new n.transports.Console({level:"debug",handleExceptions:!0}),new n.transports.File({filename:"error.log",level:"error"}),new n.transports.File({filename:"system.log"})],exitOnError:!1})}return t.prototype.init=function(){this.logger.info("created LoggerSrv")},t.prototype.write=function(t,e){this.logger.info(t)},t.prototype.alert=function(t,e){void 0===e&&(e=3),this.logger.alert(t)},t.prototype.crit=function(t,e){void 0===e&&(e=3),this.logger.crit(t)},t.prototype.data=function(t,e){void 0===e&&(e=3),this.logger.data(t)},t.prototype.debug=function(t,e){void 0===e&&(e=3),this.logger.debug(t)},t.prototype.error=function(t,e){void 0===e&&(e=3),this.logger.error(t)},t.prototype.help=function(t,e){void 0===e&&(e=3),this.logger.help(t)},t.prototype.input=function(t,e){void 0===e&&(e=3),this.logger.input(t)},t.prototype.info=function(t,e){void 0===e&&(e=3),this.logger.info(t)},t.prototype.log=function(t,e,r){void 0===r&&(r=3),this.logger.log(t,e)},t.prototype.notice=function(t,e){void 0===e&&(e=3),this.logger.notice(t)},t.prototype.sql=function(t,e){void 0===e&&(e=3),this.debug(t,e)},t.prototype.prompt=function(t,e){void 0===e&&(e=3),this.logger.prompt(t)},t.prototype.silly=function(t,e){void 0===e&&(e=3),this.logger.silly(t)},t.prototype.verbose=function(t,e){void 0===e&&(e=3),this.logger.verbose(t)},t.prototype.warn=function(t,e){void 0===e&&(e=3),this.logger.warn(t)},t.prototype.warning=function(t,e){void 0===e&&(e=3),this.logger.warning(t)},t=i([Object(o.Service)(),c("design:paramtypes",[])],t)}(),s=function(t,e,r,n){var o,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(e,r,c):o(e,r))||c);return i>3&&c&&Object.defineProperty(e,r,c),c},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},f=function(){function t(t){this.logger=t,this.logger.info("created SettingSrv"),this.settings=this.loadSettingFile()}return t.prototype.init=function(){return Promise.resolve()},t.prototype.uid=function(t){return t=t||7,Math.random().toString(35).substr(2,t)},t.prototype.loadSettingFile=function(){return r(21)},t.prototype.getPort=function(){return this.settings.port},t.prototype.getSystemDbName=function(){return this.settings.sqlite},t.prototype.getSettings=function(){return this.settings},t=s([Object(o.Service)(),u("design:paramtypes",[a])],t)}(),l=function(t,e,r,n){var o,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(e,r,c):o(e,r))||c);return i>3&&c&&Object.defineProperty(e,r,c),c},p=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},g=function(){function t(t){this.logger=t,this.sockets={},this.logger.info("created SocketMangerSrv")}return t.prototype.init=function(){return Promise.resolve()},t.prototype.addSocket=function(t){var e=t.id;this.sockets[e]=t,this.logger.info("registerd "+e)},t.prototype.delSocket=function(t){this.logger.info("unregisterd "+t),delete this.sockets[t]},t.prototype.getSocket=function(t){return this.sockets[t]},t.prototype.isExistSocket=function(t){return!!this.sockets[t]},t.prototype.getAll=function(){return this.sockets},t.prototype.emitAll=function(t,e){for(var r in this.sockets){this.sockets[r].emit(t,e)}},t=l([Object(o.Service)(),p("design:paramtypes",[a])],t)}(),d=r(7);r.d(e,"a",function(){return a}),r.d(e,"b",function(){return f}),r.d(e,"c",function(){return g}),r.d(e,"d",function(){return d.a})},function(t,e){t.exports=require("reflect-metadata")},function(t,e){t.exports=require("socket-controllers")},function(t,e){t.exports=require("winston")},function(t,e){t.exports=require("routing-controllers")},function(t,e,r){"use strict";r(3);var n,o=r(0),i=r(2),c=r(8),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=function(t,e,r,n){var o,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(e,r,c):o(e,r))||c);return i>3&&c&&Object.defineProperty(e,r,c),c},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},f=r(22),l=r(10).dataType,p=function(t){function e(e,r){var n=t.call(this)||this;return n.loggerService=e,n.settingSrv=r,n.loggerService.info("created StorageSrv"),n.dbname=n.settingSrv.getSystemDbName(),n}return a(e,t),e.prototype.init=function(){var t=this;return new Promise(function(e,r){t.connect(t.dbname).then(function(r){t.db=r,t.loggerService.info("Connected to the "+t.dbname+" database."),e()},function(t){r(t)})})},e.prototype.connect=function(t){var e=this;return this.loggerService.info("try load sqlite : "+t),this.loggerService.sql=this.sqlLogger.bind(this),new Promise(function(t,r){var n={mod:{log:e.loggerService,type:l},interfaces:{SeederInterface:{},MigratorInterfrace:{}}},o={driver:"sqlite3",filename:e.dbname};f.connect(o,n,function(e,n){e?r(e):(n.all("PRAGMA foreign_keys=ON"),t(n))})})},e.prototype.sqlLogger=function(){},e=s([Object(o.Service)(),u("design:paramtypes",[i.a,i.b])],e)}(c.EventEmitter);e.a=p},function(t,e){t.exports=require("events")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("db-migrate-shared")},function(t,e,r){"use strict";(function(t){r(3);var n,o=r(6),i=r(4),c=r(0),a=r(12),s=r.n(a),u=r(9),f=r.n(u),l=r(13),p=r.n(l),g=(r(24),r(1)),d=r(8),y=r(14),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),v=function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function c(t){try{s(n.next(t))}catch(t){i(t)}}function a(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(c,a)}s((n=n.apply(t,e||[])).next())})},b=function(t,e){var r,n,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},m=r(16),S=r(17),O=r(18),j=r(19),R=(r(20),function(e){function n(n){var a=this,u=j.join("dist","public");a=e.call(this)||this,Object(o.useContainer)(c.Container),Object(i.useContainer)(c.Container),a.app=f()(),a.app.use(O()),a.app.engine("html",r(23).renderFile),a.app.set("views",j.join(u)),a.app.set("view engine","html"),Object(o.useExpressServer)(a.app),a.server=s.a.createServer(a.app),a.app.use("/public",f.a.static(u)),a.io=p()(a.server),a.io.use(function(t,e){console.log("Custom middleware"),e()}),console.log(t),Object(i.useSocketServer)(a.io,{controllers:[j.join(t,"controllers","websocket","*.js")]});var l=c.Container.get(g.a);return l.info("\n"+S.textSync("Sample")),a.app.use(m("combined",{stream:l})),a.addServices(),a.port=n?parseInt(n,10):c.Container.get(g.b).getPort(),a}return h(n,e),n.prototype.addMiddleware=function(t){this.app.use(t)},n.prototype.addServices=function(){return v(this,void 0,void 0,function(){var t,e,r,n,o,i,a,s,u,f,l,p;return b(this,function(d){switch(d.label){case 0:for(t=[{name:"socketIO",instance:this.io}],e=c.Container.get(g.a),r=0,n=t;r<n.length;r++)i=(o=n[r]).name,l=o.instance,c.Container.set(i,l),e.info("[init] DI Registered "+i);a=[g.b,g.d,y.a,g.c],s=0,u=a,d.label=1;case 1:if(!(s<u.length))return[3,6];f=u[s],d.label=2;case 2:return d.trys.push([2,4,,5]),[4,(l=c.Container.get(f)).init()];case 3:return d.sent(),e.info("[Serivce Initialize] DI Registered "+f.name),[3,5];case 4:return p=d.sent(),console.log(p.stack),e.error(p),[3,5];case 5:return s++,[3,1];case 6:return this.emit("ready"),[2]}})})},n.prototype.getApp=function(){return this.app},n.prototype.runServ=function(){var t=this,e=c.Container.get(g.a);return new Promise(function(r){t.once("ready",function(){return v(t,void 0,void 0,function(){var t=this;return b(this,function(n){return r(this.server.listen(this.port,function(){return e.info("listening on port "+t.port)})),[2]})})})})},n}(d.EventEmitter));e.a=R}).call(this,"server")},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("socket.io")},function(t,e,r){"use strict";r(3);var n,o=r(0),i=r(8),c=r(7),a=r(2),s=function(t,e,r,n){var o,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(e,r,c):o(e,r))||c);return i>3&&c&&Object.defineProperty(e,r,c),c},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},f=r(10).dataType,l=function(){function t(t,e){this.logger=t,this.storageSrv=e,this.tableName="migration_log",this.logger.info("created Migration_logRepository")}return t.prototype.init=function(){return Promise.resolve()},t.prototype.migrations=function(){var t=this;return[{migration_id:"create table migration_log",action:"createTable",args:[this.tableName,{id:{type:f.INTEGER,primaryKey:!0,autoIncrement:!0,notNull:!0},migration_id:{type:f.STRING,length:255},action:{type:f.STRING,notNull:!0,length:20},params:{type:f.TEXT,notNull:!0,defaultValue:""},success:{type:f.BOOLEAN,notNull:!0},error:{type:f.TEXT,defaultValue:""},timestamp:{type:f.DATE_TIME,defaultValue:new String("CURRENT_TIMESTAMP")}},function(e){e&&t.logger.error(e)}]}]},t.prototype.getMigrationLog=function(){var t=this;return new Promise(function(e){t.storageSrv.db.all("select * from migration_log",function(t,r){e(t?[]:r)})})},t=s([Object(o.Service)(),u("design:paramtypes",[a.a,c.a])],t)}(),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),g=function(t,e,r,n){var o,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(e,r,c):o(e,r))||c);return i>3&&c&&Object.defineProperty(e,r,c),c},d=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},y=function(t){function e(e,r,n){var o=t.call(this)||this;return o.logger=e,o.storageSrv=r,o.migrationLogRepository=n,o.migrations=[],o.logger.info("created StorageMigrationSrv"),o}return p(e,t),e.prototype.init=function(){var t=this,e={};return this.migrationLogRepository.getMigrationLog().then(function(t){for(var r=0,n=t;r<n.length;r++){var o=n[r];o.success&&(e[o.migration_id]=o)}return e}).then(function(e){t.addMigrations(),t.dbMigration(e)})},e.prototype.addMigration=function(t,e,r){this.migrations.push({migration_id:t,action:e,args:r})},e.prototype.addMigrations=function(){for(var t=0,e=[this.migrationLogRepository.migrations()];t<e.length;t++){var r=e[t];this.migrations=this.migrations.concat(r)}},e.prototype.dbMigration=function(t){for(var e=this,r=function(r,o,i){if(!t[r]){n.logger.info("execute "+r);var c=i[i.length-1];i[i.length-1]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var a=t[0],s=!a,u=a?a.message.replace(/\"/gi,"'"):"",f=JSON.stringify(i.slice(0,i.length-1)).replace(/\"/gi,"'");e.storageSrv.db.insert("migration_log",["migration_id","action","success","error","params"],[r,o,s,u,f],function(t){t&&e.logger.error(t)}),c.apply(e.storageSrv.db,t)};try{n.storageSrv.db[o].apply(n.storageSrv.db,i)}catch(t){n.logger.error(t)}}},n=this,o=0,i=this.migrations;o<i.length;o++){var c=i[o];r(c.migration_id,c.action,c.args)}},e=g([Object(o.Service)(),d("design:paramtypes",[a.a,c.a,l])],e)}(i.EventEmitter);e.a=y},function(t,e,r){"use strict";r.r(e),new(r(11).a)(process.env.PORT).runServ()},function(t,e){t.exports=require("morgan")},function(t,e){t.exports=require("figlet")},function(t,e){t.exports=require("cors")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("open")},function(t){t.exports={port:4e3,sqlite:"database.db",default:{destinations:[{receiver:"websocket",info:{}}]}}},function(t,e){t.exports=require("db-migrate-sqlite3")},function(t,e){t.exports=require("ejs")},function(t,e,r){"use strict";r(3);var n=r(6),o=r(1),i=function(t,e,r,n){var o,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(e,r,c):o(e,r))||c);return i>3&&c&&Object.defineProperty(e,r,c),c},c=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=(function(){function t(t){this.loggerSrv=t,this.loggerSrv.info("created RootController")}t.prototype.helloServer=function(){},t.prototype.getApi=function(){return[{hello:"Hello Node.js Express Server"}]},i([Object(n.Get)("/"),Object(n.Render)("index.html"),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],t.prototype,"helloServer",null),i([Object(n.Get)("/api"),c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],t.prototype,"getApi",null),t=i([Object(n.Controller)(""),c("design:paramtypes",[o.a])],t)}(),r(4)),s=function(t,e,r,n){var o,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(c=(i<3?o(c):i>3?o(e,r,c):o(e,r))||c);return i>3&&c&&Object.defineProperty(e,r,c),c},u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},f=function(t,e){return function(r,n){e(r,n,t)}};!function(){function t(t,e){this.sockMgrSrv=t,this.loggerSrv=e,this.loggerSrv.info("created WsMessageController")}t.prototype.connection=function(t){this.sockMgrSrv.addSocket(t),this.loggerSrv.info("client connected")},t.prototype.disconnect=function(t){var e=t.id;this.sockMgrSrv.delSocket(e)},s([Object(a.OnConnect)(),f(0,Object(a.ConnectedSocket)()),u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],t.prototype,"connection",null),s([Object(a.OnDisconnect)(),f(0,Object(a.ConnectedSocket)()),u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],t.prototype,"disconnect",null),t=s([Object(a.SocketController)("/ws"),u("design:paramtypes",[o.c,o.a])],t)}()}]);
//# sourceMappingURL=server.bundle.js.map