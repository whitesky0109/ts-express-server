{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./main.ts","webpack:///./server/controllers/index.ts","webpack:///./server/controllers/rest/RootController.ts","webpack:///./server/controllers/websocket/WsMessageController.ts","webpack:///./server/index.ts","webpack:///./server/services/index.ts","webpack:///./server/services/system/Logger.service.ts","webpack:///./server/services/system/Setting.service.ts","webpack:///./server/services/system/SocketManager.service.ts","webpack:///./server/services/system/Storage.service.ts","webpack:///./server/services/system/StorageMigration.service.ts","webpack:///./server/services/system/index.ts","webpack:///./server/services/system/repositories/migrationLog.repository.ts","webpack:///external \"cors\"","webpack:///external \"db-migrate-shared\"","webpack:///external \"db-migrate-sqlite3\"","webpack:///external \"ejs\"","webpack:///external \"events\"","webpack:///external \"express\"","webpack:///external \"figlet\"","webpack:///external \"http\"","webpack:///external \"morgan\"","webpack:///external \"open\"","webpack:///external \"path\"","webpack:///external \"reflect-metadata\"","webpack:///external \"routing-controllers\"","webpack:///external \"socket-controllers\"","webpack:///external \"socket.io\"","webpack:///external \"typedi\"","webpack:///external \"winston\""],"names":[],"mappings":"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AACA,QAAQ,sDAAO;AACf;AACA;AACA;AACA,CAAC;AACc,4EAAa,EAAC;;;;;;;;;;;;;AC/G7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AAC0B;AACO;AACC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAAS;AACxB,gBAAgB,SAAS;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,mBAAO,CAAC,6DAA0B;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,sDAAO;AACf,yCAAyC,+CAAa;AACtD;AACA;AACA,CAAC;AACc,6EAAc,EAAC;;;;;;;;;;;;;ACnD9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AAC0B;AACO;AACC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,sDAAO;AACf,yCAAyC,+CAAa;AACtD;AACA;AACA,CAAC;AACc,mFAAoB,EAAC;;;;;;;;;;;;;ACnDpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,mBAAO,CAAC,8CAAoB;AACzC,eAAe,mBAAO,CAAC,4CAAmB;AAChB;AACO;AACiB;AACZ;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,uCAAuC;AACvC,0CAA0C;AAC1C,iBAAiB;AACjB;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA;AACA;AACA,QAAQ,sDAAO;AACf,yCAAyC,+CAAa;AACtD,YAAY,gDAAc;AAC1B;AACA;AACA,CAAC,CAAC,mDAAY;AACC,6EAAc,EAAC;;;;;;;;;;;;;ACpG9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,uDAAuD;AACpF;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AAC0B;AACO;AACK;AACsC;AAC7B;AACb;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,oBAAoB;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,8BAA8B,yDAAyD;AACvF;AACA;AACA;AACA;AACA;AACA,qCAAqC,mBAAmB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,uBAAuB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,gBAAgB;AAC9D;AACA;AACA;AACA;AACA;AACA,QAAQ,sDAAO;AACf,yCAAyC,+CAAa;AACtD,YAAY,wDAAc;AAC1B,YAAY,6EAAsB;AAClC;AACA;AACA,CAAC,CAAC,mDAAY;AACC,sFAAuB,EAAC;;;;;;;;;;;;;ACrHvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA6C;AACE;AACY;AACZ;AACiC;;;;;;;;;;;;;ACJhF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA,kBAAkB,SAAI,IAAI,SAAI;AAC9B;AACA;AAC0B;AACO;AACe;AACb;AACnC,eAAe,mBAAO,CAAC,4CAAmB;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B,kFAAkF;AAClF,uCAAuC,qCAAqC;AAC5E,iCAAiC,mDAAmD;AACpF,iCAAiC,uDAAuD;AACxF,kCAAkC,wCAAwC;AAC1E,gCAAgC,wCAAwC;AACxE;AACA,oCAAoC,0EAA0E;AAC9G,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,QAAQ,sDAAO;AACf,yCAAyC,+CAAa;AACtD,YAAY,wDAAc;AAC1B;AACA;AACA,CAAC;AACc,qFAAsB,EAAC;;;;;;;;;;;;ACtEtC,iC;;;;;;;;;;;ACAA,8C;;;;;;;;;;;ACAA,+C;;;;;;;;;;;ACAA,gC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,oC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,iC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,iC;;;;;;;;;;;ACAA,iC;;;;;;;;;;;ACAA,6C;;;;;;;;;;;ACAA,gD;;;;;;;;;;;ACAA,+C;;;;;;;;;;;ACAA,sC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,oC","file":"server.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./main.ts\");\n","import server from './server';\r\nvar serv = new server(process.env.PORT);\r\nserv.runServ();\r\n","import './rest/RootController';\r\nimport './websocket/WsMessageController';\r\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport 'reflect-metadata';\r\nimport { Controller, Get, Render } from 'routing-controllers';\r\nimport { LoggerService } from '../../services';\r\nvar RootController = /** @class */ (function () {\r\n    function RootController(loggerSrv) {\r\n        this.loggerSrv = loggerSrv;\r\n        this.loggerSrv.info('created RootController');\r\n    }\r\n    RootController.prototype.helloServer = function () {\r\n    };\r\n    RootController.prototype.getApi = function () {\r\n        return [\r\n            { hello: 'Hello Node.js Express Server' },\r\n        ];\r\n    };\r\n    __decorate([\r\n        Get('/'),\r\n        Render('index.html'),\r\n        __metadata(\"design:type\", Function),\r\n        __metadata(\"design:paramtypes\", []),\r\n        __metadata(\"design:returntype\", void 0)\r\n    ], RootController.prototype, \"helloServer\", null);\r\n    __decorate([\r\n        Get('/api'),\r\n        __metadata(\"design:type\", Function),\r\n        __metadata(\"design:paramtypes\", []),\r\n        __metadata(\"design:returntype\", void 0)\r\n    ], RootController.prototype, \"getApi\", null);\r\n    RootController = __decorate([\r\n        Controller(''),\r\n        __metadata(\"design:paramtypes\", [LoggerService])\r\n    ], RootController);\r\n    return RootController;\r\n}());\r\nexport { RootController };\r\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { OnConnect, SocketController, ConnectedSocket, OnDisconnect } from 'socket-controllers';\r\nimport { SocketManagerService, LoggerService } from '../../services';\r\nvar WsMessageController = /** @class */ (function () {\r\n    function WsMessageController(sockMgrSrv, loggerSrv) {\r\n        this.sockMgrSrv = sockMgrSrv;\r\n        this.loggerSrv = loggerSrv;\r\n        this.loggerSrv.info('created WsMessageController');\r\n    }\r\n    WsMessageController.prototype.connection = function (socket) {\r\n        this.sockMgrSrv.addSocket(socket);\r\n        this.loggerSrv.info('client connected');\r\n    };\r\n    WsMessageController.prototype.disconnect = function (socket) {\r\n        var id = socket.id;\r\n        this.sockMgrSrv.delSocket(id);\r\n    };\r\n    __decorate([\r\n        OnConnect(),\r\n        __param(0, ConnectedSocket()),\r\n        __metadata(\"design:type\", Function),\r\n        __metadata(\"design:paramtypes\", [Object]),\r\n        __metadata(\"design:returntype\", void 0)\r\n    ], WsMessageController.prototype, \"connection\", null);\r\n    __decorate([\r\n        OnDisconnect(),\r\n        __param(0, ConnectedSocket()),\r\n        __metadata(\"design:type\", Function),\r\n        __metadata(\"design:paramtypes\", [Object]),\r\n        __metadata(\"design:returntype\", void 0)\r\n    ], WsMessageController.prototype, \"disconnect\", null);\r\n    WsMessageController = __decorate([\r\n        SocketController('/ws'),\r\n        __metadata(\"design:paramtypes\", [SocketManagerService,\r\n            LoggerService])\r\n    ], WsMessageController);\r\n    return WsMessageController;\r\n}());\r\nexport { WsMessageController };\r\n","var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport 'reflect-metadata';\r\nimport { useContainer, useExpressServer } from 'routing-controllers';\r\nimport { useContainer as useContainerSocket, useSocketServer } from 'socket-controllers';\r\nimport { Container } from 'typedi';\r\nimport http from 'http';\r\nimport express from 'express';\r\nimport socketIo from 'socket.io';\r\nvar morgan = require('morgan');\r\nvar figlet = require('figlet');\r\nvar cors = require('cors');\r\nvar path = require('path');\r\nvar open = require('open');\r\nimport './controllers';\r\nimport { \r\n// System Services\r\nSettingService, StorageService, LoggerService, \r\n// Message Processing Services\r\nSocketManagerService, } from './services';\r\nimport { EventEmitter } from 'events';\r\nimport StorageMigrationService from './services/system/StorageMigration.service';\r\nvar MainServer = /** @class */ (function (_super) {\r\n    __extends(MainServer, _super);\r\n    function MainServer(port) {\r\n        var _this = this;\r\n        var rootPath = path.join('dist', 'public');\r\n        _this = _super.call(this) || this;\r\n        /* setter */\r\n        useContainer(Container);\r\n        useContainerSocket(Container);\r\n        /* create Server */\r\n        _this.app = express();\r\n        _this.app.use(cors());\r\n        /* set Html View Render */\r\n        _this.app.engine('html', require('ejs').renderFile);\r\n        _this.app.set('views', path.join(rootPath));\r\n        _this.app.set('view engine', 'html');\r\n        useExpressServer(_this.app);\r\n        _this.server = http.createServer(_this.app);\r\n        _this.app.use('/public', express.static(rootPath));\r\n        /* create websocket listener */\r\n        _this.io = socketIo(_this.server);\r\n        _this.io.use(function (socket, next) {\r\n            console.log('Custom middleware');\r\n            next();\r\n        });\r\n        console.log(__dirname);\r\n        useSocketServer(_this.io, {\r\n            controllers: [path.join(__dirname, 'controllers', 'websocket', '*.js')],\r\n        });\r\n        /* create System Logger */\r\n        var loggerSrv = Container.get(LoggerService);\r\n        loggerSrv.info(\"\\n\" + figlet.textSync('Sample'));\r\n        /* register logger Service */\r\n        _this.app.use(morgan('combined', { stream: loggerSrv }));\r\n        /* register service instance */\r\n        _this.addServices();\r\n        _this.port = port ? parseInt(port, 10) : Container.get(SettingService).getPort();\r\n        return _this;\r\n    }\r\n    MainServer.prototype.addMiddleware = function (middleware) {\r\n        this.app.use(middleware);\r\n    };\r\n    MainServer.prototype.addServices = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var etcInstances, loggerSrv, _i, etcInstances_1, _a, name_1, instance, registerServices, _b, registerServices_1, service, instance, e_1;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        etcInstances = [\r\n                            { name: 'socketIO', instance: this.io },\r\n                        ];\r\n                        loggerSrv = Container.get(LoggerService);\r\n                        for (_i = 0, etcInstances_1 = etcInstances; _i < etcInstances_1.length; _i++) {\r\n                            _a = etcInstances_1[_i], name_1 = _a.name, instance = _a.instance;\r\n                            Container.set(name_1, instance);\r\n                            loggerSrv.info(\"[init] DI Registered \" + name_1);\r\n                        }\r\n                        registerServices = [\r\n                            /* System Services */\r\n                            SettingService,\r\n                            StorageService,\r\n                            StorageMigrationService,\r\n                            SocketManagerService,\r\n                        ];\r\n                        _b = 0, registerServices_1 = registerServices;\r\n                        _c.label = 1;\r\n                    case 1:\r\n                        if (!(_b < registerServices_1.length)) return [3 /*break*/, 6];\r\n                        service = registerServices_1[_b];\r\n                        _c.label = 2;\r\n                    case 2:\r\n                        _c.trys.push([2, 4, , 5]);\r\n                        instance = Container.get(service);\r\n                        return [4 /*yield*/, instance.init()];\r\n                    case 3:\r\n                        _c.sent();\r\n                        loggerSrv.info(\"[Serivce Initialize] DI Registered \" + service.name);\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        e_1 = _c.sent();\r\n                        console.log(e_1.stack);\r\n                        loggerSrv.error(e_1);\r\n                        return [3 /*break*/, 5];\r\n                    case 5:\r\n                        _b++;\r\n                        return [3 /*break*/, 1];\r\n                    case 6:\r\n                        this.emit('ready');\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    MainServer.prototype.getApp = function () {\r\n        return this.app;\r\n    };\r\n    MainServer.prototype.runServ = function () {\r\n        var _this = this;\r\n        var loggerSrv = Container.get(LoggerService);\r\n        return new Promise(function (resolve) {\r\n            _this.once('ready', function () { return __awaiter(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator(this, function (_a) {\r\n                    switch (_a.label) {\r\n                        case 0:\r\n                            resolve(this.server.listen(this.port, function () {\r\n                                return loggerSrv.info(\"listening on port \" + _this.port);\r\n                            }));\r\n                            return [4 /*yield*/, open('http://localhost:4000')];\r\n                        case 1:\r\n                            _a.sent();\r\n                            return [2 /*return*/];\r\n                    }\r\n                });\r\n            }); });\r\n        });\r\n    };\r\n    return MainServer;\r\n}(EventEmitter));\r\nexport default MainServer;\r\n","import 'reflect-metadata';\r\n// System Services\r\nimport { SettingService, StorageService, LoggerService, SocketManagerService, } from './system';\r\nexport { StorageService, SocketManagerService, SettingService, LoggerService, };\r\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport 'reflect-metadata';\r\nimport { format, createLogger, transports } from 'winston';\r\nimport { Service } from 'typedi';\r\nvar LoggerService = /** @class */ (function () {\r\n    function LoggerService() {\r\n        this.logger = createLogger({\r\n            // level: 'info',\r\n            format: format.combine(format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }), format(function (info) {\r\n                if (info.level === 'error') {\r\n                    return Object.assign({}, info, {\r\n                        message: info.timestamp + \" \" + info.stack,\r\n                    });\r\n                }\r\n                return info;\r\n            })(), format.printf(function (_a) {\r\n                var timestamp = _a.timestamp, level = _a.level, message = _a.message, meta = _a.meta;\r\n                return (meta)\r\n                    ? timestamp + \" \" + level + \" [\" + meta.filename + \":\" + meta.line + \"]: \" + message\r\n                    : timestamp + \" \" + level + \" \" + message;\r\n            })),\r\n            transports: [\r\n                new transports.Console({ level: 'debug', handleExceptions: true }),\r\n                new transports.File({ filename: 'error.log', level: 'error' }),\r\n                new transports.File({ filename: 'system.log' }),\r\n            ],\r\n            exitOnError: false,\r\n        });\r\n    }\r\n    LoggerService.prototype.init = function () {\r\n        this.logger.info('created LoggerSrv');\r\n    };\r\n    LoggerService.prototype.write = function (message, encoding) { this.logger.info(message); };\r\n    LoggerService.prototype.alert = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.alert(msg);\r\n    };\r\n    LoggerService.prototype.crit = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.crit(msg);\r\n    };\r\n    LoggerService.prototype.data = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.data(msg);\r\n    };\r\n    LoggerService.prototype.debug = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.debug(msg);\r\n    };\r\n    LoggerService.prototype.error = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.error(msg);\r\n    };\r\n    LoggerService.prototype.help = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.help(msg);\r\n    };\r\n    LoggerService.prototype.input = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.input(msg);\r\n    };\r\n    LoggerService.prototype.info = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.info(msg);\r\n    };\r\n    LoggerService.prototype.log = function (level, msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.log(level, msg);\r\n    };\r\n    LoggerService.prototype.notice = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.notice(msg);\r\n    };\r\n    LoggerService.prototype.sql = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.debug(msg, index);\r\n    };\r\n    LoggerService.prototype.prompt = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.prompt(msg);\r\n    };\r\n    LoggerService.prototype.silly = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.silly(msg);\r\n    };\r\n    LoggerService.prototype.verbose = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.verbose(msg);\r\n    };\r\n    LoggerService.prototype.warn = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.warn(msg);\r\n    };\r\n    LoggerService.prototype.warning = function (msg, index) {\r\n        if (index === void 0) { index = 3; }\r\n        this.logger.warning(msg);\r\n    };\r\n    LoggerService = __decorate([\r\n        Service(),\r\n        __metadata(\"design:paramtypes\", [])\r\n    ], LoggerService);\r\n    return LoggerService;\r\n}());\r\nexport default LoggerService;\r\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport 'reflect-metadata';\r\nimport { Service } from 'typedi';\r\nimport { LoggerService } from '.';\r\nvar SettingService = /** @class */ (function () {\r\n    function SettingService(logger) {\r\n        this.logger = logger;\r\n        this.logger.info('created SettingSrv');\r\n        this.settings = this.loadSettingFile();\r\n    }\r\n    SettingService.prototype.init = function () {\r\n        return Promise.resolve();\r\n    };\r\n    /**\r\n     * Create a `uid`\r\n     *\r\n     * @param { Number } len\r\n     * @return { String } uid\r\n     */\r\n    SettingService.prototype.uid = function (len) {\r\n        // create uuid\r\n        len = len || 7;\r\n        return Math.random().toString(35).substr(2, len);\r\n    };\r\n    SettingService.prototype.loadSettingFile = function () {\r\n        var config = require('../../config/config.json');\r\n        return config;\r\n    };\r\n    SettingService.prototype.getPort = function () {\r\n        return this.settings['port'];\r\n    };\r\n    SettingService.prototype.getSystemDbName = function () {\r\n        return this.settings.sqlite;\r\n    };\r\n    SettingService.prototype.getSettings = function () {\r\n        return this.settings;\r\n    };\r\n    SettingService = __decorate([\r\n        Service(),\r\n        __metadata(\"design:paramtypes\", [LoggerService])\r\n    ], SettingService);\r\n    return SettingService;\r\n}());\r\nexport default SettingService;\r\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport 'reflect-metadata';\r\nimport { Service } from 'typedi';\r\nimport { LoggerService } from '.';\r\nvar SocketManagerService = /** @class */ (function () {\r\n    function SocketManagerService(logger) {\r\n        this.logger = logger;\r\n        this.sockets = {};\r\n        this.logger.info('created SocketMangerSrv');\r\n    }\r\n    SocketManagerService.prototype.init = function () {\r\n        return Promise.resolve();\r\n    };\r\n    SocketManagerService.prototype.addSocket = function (socket) {\r\n        var id = socket.id;\r\n        this.sockets[id] = socket;\r\n        this.logger.info(\"registerd \" + id);\r\n    };\r\n    SocketManagerService.prototype.delSocket = function (id) {\r\n        this.logger.info(\"unregisterd \" + id);\r\n        delete this.sockets[id];\r\n    };\r\n    SocketManagerService.prototype.getSocket = function (id) {\r\n        return this.sockets[id];\r\n    };\r\n    SocketManagerService.prototype.isExistSocket = function (id) {\r\n        return !!this.sockets[id];\r\n    };\r\n    SocketManagerService.prototype.getAll = function () {\r\n        return this.sockets;\r\n    };\r\n    SocketManagerService.prototype.emitAll = function (event, message) {\r\n        for (var id in this.sockets) {\r\n            var socket = this.sockets[id];\r\n            socket.emit(event, message);\r\n        }\r\n    };\r\n    SocketManagerService = __decorate([\r\n        Service(),\r\n        __metadata(\"design:paramtypes\", [LoggerService])\r\n    ], SocketManagerService);\r\n    return SocketManagerService;\r\n}());\r\nexport default SocketManagerService;\r\n","var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\n/*\r\n    sqlite3 node libraries\r\n    ref: https://db-migrate.readthedocs.io/en/latest/API/SQL/#migrations-api-sql\r\n*/\r\nvar driver = require('db-migrate-sqlite3');\r\nvar dataType = require('db-migrate-shared').dataType;\r\nimport 'reflect-metadata';\r\nimport { Service } from 'typedi';\r\nimport { SettingService, LoggerService } from '.';\r\nimport { EventEmitter } from 'events';\r\nvar StorageService = /** @class */ (function (_super) {\r\n    __extends(StorageService, _super);\r\n    function StorageService(logger, settingSrv) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        _this.settingSrv = settingSrv;\r\n        _this.logger.info('created StorageSrv');\r\n        _this.dbname = _this.settingSrv.getSystemDbName();\r\n        return _this;\r\n    }\r\n    StorageService.prototype.init = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.connect(_this.dbname).then(function (db) {\r\n                _this.db = db;\r\n                _this.logger.info(\"Connected to the \" + _this.dbname + \" database.\");\r\n                resolve();\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    StorageService.prototype.connect = function (dbname) {\r\n        var _this = this;\r\n        this.logger.info(\"try load sqlite : \" + dbname);\r\n        this.logger['sql'] = this.sqlLogger.bind(this);\r\n        return new Promise(function (resolve, reject) {\r\n            /* if not exist then create database file */\r\n            var internals = {\r\n                mod: {\r\n                    log: _this.logger,\r\n                    type: dataType,\r\n                },\r\n                interfaces: {\r\n                    SeederInterface: {},\r\n                    MigratorInterfrace: {},\r\n                },\r\n            };\r\n            var val = { driver: 'sqlite3', filename: _this.dbname };\r\n            driver.connect(val, internals, function (err, db) {\r\n                if (err) {\r\n                    reject(err);\r\n                }\r\n                else {\r\n                    db.all('PRAGMA foreign_keys=ON');\r\n                    resolve(db);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    StorageService.prototype.sqlLogger = function () {\r\n        /*\r\n        this.logger.debug(arguments[0], {\r\n          meta: {\r\n            __filename,\r\n            __function: (global as any).__function,\r\n            __line: (global as any).__line,\r\n          },\r\n        });\r\n        */\r\n    };\r\n    StorageService = __decorate([\r\n        Service(),\r\n        __metadata(\"design:paramtypes\", [LoggerService,\r\n            SettingService])\r\n    ], StorageService);\r\n    return StorageService;\r\n}(EventEmitter));\r\nexport default StorageService;\r\n","var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport 'reflect-metadata';\r\nimport { Service } from 'typedi';\r\nimport { EventEmitter } from 'events';\r\nimport migrationLogRepository from './repositories/migrationLog.repository';\r\nimport StorageService from './Storage.service';\r\nimport { LoggerService } from '.';\r\nvar StorageMigrationService = /** @class */ (function (_super) {\r\n    __extends(StorageMigrationService, _super);\r\n    function StorageMigrationService(logger, storageSrv, \r\n    /* sqlite3 table reposiotries */\r\n    migrationLogRepository) {\r\n        var _this = _super.call(this) || this;\r\n        _this.logger = logger;\r\n        _this.storageSrv = storageSrv;\r\n        _this.migrationLogRepository = migrationLogRepository;\r\n        _this.migrations = [];\r\n        _this.logger.info('created StorageMigrationSrv');\r\n        return _this;\r\n    }\r\n    StorageMigrationService.prototype.init = function () {\r\n        var _this = this;\r\n        var migrationLogs = {};\r\n        return this.migrationLogRepository.getMigrationLog().then(function (logs) {\r\n            for (var _i = 0, logs_1 = logs; _i < logs_1.length; _i++) {\r\n                var log = logs_1[_i];\r\n                if (log.success) {\r\n                    migrationLogs[log.migration_id] = log;\r\n                }\r\n            }\r\n            return migrationLogs;\r\n        }).then(function (migrationLogs) {\r\n            _this.addMigrations();\r\n            _this.dbMigration(migrationLogs);\r\n        });\r\n    };\r\n    // tslint:disable-next-line: variable-name\r\n    StorageMigrationService.prototype.addMigration = function (migration_id, action, args) {\r\n        this.migrations.push({ migration_id: migration_id, action: action, args: args });\r\n    };\r\n    StorageMigrationService.prototype.addMigrations = function () {\r\n        var arr = [\r\n            this.migrationLogRepository.migrations(),\r\n        ];\r\n        for (var _i = 0, arr_1 = arr; _i < arr_1.length; _i++) {\r\n            var migration = arr_1[_i];\r\n            this.migrations = this.migrations.concat(migration);\r\n        }\r\n    };\r\n    StorageMigrationService.prototype.dbMigration = function (migrationLogs) {\r\n        var _this = this;\r\n        var _loop_1 = function (migration_id, action, args) {\r\n            if (!migrationLogs[migration_id]) {\r\n                this_1.logger.info(\"execute \" + migration_id);\r\n                /* change callback function */\r\n                var callback_1 = args[args.length - 1];\r\n                args[args.length - 1] = function () {\r\n                    var params = [];\r\n                    for (var _i = 0; _i < arguments.length; _i++) {\r\n                        params[_i] = arguments[_i];\r\n                    }\r\n                    var err = params[0];\r\n                    var success = !err ? true : false;\r\n                    /* double quatation이 들어간 경우 오류 발생 */\r\n                    var error = err ? err.message.replace(/\\\"/gi, \"'\") : '';\r\n                    var arg = JSON.stringify(args.slice(0, args.length - 1)).replace(/\\\"/gi, \"'\");\r\n                    /* write migration_log */\r\n                    _this.storageSrv.db['insert']('migration_log', ['migration_id', 'action', 'success', 'error', 'params'], [migration_id, action, success, error, arg], function (err) {\r\n                        if (err) {\r\n                            _this.logger.error(err);\r\n                        }\r\n                    });\r\n                    callback_1.apply(_this.storageSrv.db, params);\r\n                };\r\n                try {\r\n                    this_1.storageSrv.db[action].apply(this_1.storageSrv.db, args);\r\n                }\r\n                catch (err) {\r\n                    this_1.logger.error(err);\r\n                }\r\n            }\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, _a = this.migrations; _i < _a.length; _i++) {\r\n            var _b = _a[_i], migration_id = _b.migration_id, action = _b.action, args = _b.args;\r\n            _loop_1(migration_id, action, args);\r\n        }\r\n    };\r\n    StorageMigrationService = __decorate([\r\n        Service(),\r\n        __metadata(\"design:paramtypes\", [LoggerService,\r\n            StorageService,\r\n            migrationLogRepository])\r\n    ], StorageMigrationService);\r\n    return StorageMigrationService;\r\n}(EventEmitter));\r\nexport default StorageMigrationService;\r\n","import LoggerService from './Logger.service';\r\nimport SettingService from './Setting.service';\r\nimport SocketManagerService from './SocketManager.service';\r\nimport StorageService from './Storage.service';\r\nexport { LoggerService, SettingService, SocketManagerService, StorageService, };\r\n","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport 'reflect-metadata';\r\nimport { Service } from 'typedi';\r\nimport StorageService from '../Storage.service';\r\nimport { LoggerService } from '..';\r\nvar dataType = require('db-migrate-shared').dataType;\r\nvar MigrationLogRepository = /** @class */ (function () {\r\n    function MigrationLogRepository(logger, storageSrv) {\r\n        this.logger = logger;\r\n        this.storageSrv = storageSrv;\r\n        this.tableName = 'migration_log';\r\n        this.logger.info('created Migration_logRepository');\r\n    }\r\n    MigrationLogRepository.prototype.init = function () {\r\n        return Promise.resolve();\r\n    };\r\n    /* ref: https://db-migrate.readthedocs.io/en/latest/API/SQL/#migrations-api-sql */\r\n    MigrationLogRepository.prototype.migrations = function () {\r\n        var _this = this;\r\n        return [{\r\n                migration_id: 'create table migration_log',\r\n                action: 'createTable',\r\n                args: [this.tableName, {\r\n                        id: { type: dataType.INTEGER,\r\n                            primaryKey: true, autoIncrement: true, notNull: true },\r\n                        migration_id: { type: dataType.STRING, length: 255 },\r\n                        action: { type: dataType.STRING, notNull: true, length: 20 },\r\n                        params: { type: dataType.TEXT, notNull: true, defaultValue: '' },\r\n                        success: { type: dataType.BOOLEAN, notNull: true },\r\n                        error: { type: dataType.TEXT, defaultValue: '' },\r\n                        // tslint:disable-next-line: no-construct\r\n                        timestamp: { type: dataType.DATE_TIME, defaultValue: new String('CURRENT_TIMESTAMP') },\r\n                    },\r\n                    function (err) {\r\n                        if (err) {\r\n                            _this.logger.error(err);\r\n                        }\r\n                    }],\r\n            },\r\n        ];\r\n    };\r\n    MigrationLogRepository.prototype.getMigrationLog = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var db = _this.storageSrv.db;\r\n            db['all']('select * from migration_log', function (err, logs) {\r\n                if (err) {\r\n                    resolve([]);\r\n                }\r\n                else {\r\n                    resolve(logs);\r\n                }\r\n            });\r\n        });\r\n    };\r\n    MigrationLogRepository = __decorate([\r\n        Service(),\r\n        __metadata(\"design:paramtypes\", [LoggerService,\r\n            StorageService])\r\n    ], MigrationLogRepository);\r\n    return MigrationLogRepository;\r\n}());\r\nexport default MigrationLogRepository;\r\n","module.exports = require(\"cors\");","module.exports = require(\"db-migrate-shared\");","module.exports = require(\"db-migrate-sqlite3\");","module.exports = require(\"ejs\");","module.exports = require(\"events\");","module.exports = require(\"express\");","module.exports = require(\"figlet\");","module.exports = require(\"http\");","module.exports = require(\"morgan\");","module.exports = require(\"open\");","module.exports = require(\"path\");","module.exports = require(\"reflect-metadata\");","module.exports = require(\"routing-controllers\");","module.exports = require(\"socket-controllers\");","module.exports = require(\"socket.io\");","module.exports = require(\"typedi\");","module.exports = require(\"winston\");"],"sourceRoot":""}