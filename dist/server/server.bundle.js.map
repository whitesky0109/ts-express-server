{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"reflect-metadata\"","webpack:///external \"typedi\"","webpack:///./server/services/system/index.ts","webpack:///./server/services/index.ts","webpack:///./server/services/system/Storage.service.ts","webpack:///external \"events\"","webpack:///external \"routing-controllers\"","webpack:///external \"socket-controllers\"","webpack:///external \"db-migrate-shared\"","webpack:///./main.ts","webpack:///./server/index.ts","webpack:///./server/polyfills.ts","webpack:///external \"http\"","webpack:///external \"express\"","webpack:///external \"socket.io\"","webpack:///external \"morgan\"","webpack:///external \"figlet\"","webpack:///external \"cors\"","webpack:///external \"path\"","webpack:///./server/controllers/index.ts","webpack:///./server/controllers/rest/RootController.ts","webpack:///./server/services/system/Logger.service.ts","webpack:///external \"winston\"","webpack:///./server/services/system/Setting.service.ts","webpack:///./server/services/system/SocketManager.service.ts","webpack:///external \"db-migrate-sqlite3\"","webpack:///./server/controllers/websocket/WsMessageController.ts","webpack:///./server/services/system/StorageMigration.service.ts","webpack:///./server/services/system/repositories/migrationLog.repository.ts","webpack:///external \"ejs\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","__importDefault","this","mod","default","Logger_service_1","LoggerService","Setting_service_1","SettingService","SocketManager_service_1","SocketManagerService","Storage_service_1","StorageService","system_1","__decorate","decorators","target","desc","arguments","length","getOwnPropertyDescriptor","Reflect","decorate","__metadata","k","v","metadata","driver","dataType","typedi_1","_1","events_1","EventEmitter","[object Object]","logger","settingSrv","super","info","dbname","getSystemDbName","Promise","resolve","reject","connect","then","db","error","sqlLogger","internals","log","type","interfaces","SeederInterface","MigratorInterfrace","val","filename","err","all","Service","process","env","PORT","runServ","__dirname","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","next","e","rejected","result","done","apply","routing_controllers_1","socket_controllers_1","http_1","express_1","socket_io_1","morgan","figlet","cors","path","services_1","StorageMigration_service_1","port","rootPath","join","useContainer","Container","app","use","engine","renderFile","set","useExpressServer","server","createServer","static","io","socket","console","useSocketServer","controllers","loggerSrv","textSync","stream","addServices","parseInt","getPort","middleware","etcInstances","instance","registerServices","service","init","stack","emit","once","listen","RootController","hello","Get","Render","Function","Controller","winston_1","createLogger","format","combine","timestamp","level","assign","message","printf","meta","line","transports","Console","handleExceptions","File","exitOnError","encoding","msg","index","alert","crit","data","debug","help","input","notice","prompt","silly","verbose","warn","warning","settings","loadSettingFile","len","Math","random","toString","substr","sqlite","sockets","id","event","__param","paramIndex","decorator","WsMessageController","sockMgrSrv","addSocket","delSocket","OnConnect","ConnectedSocket","OnDisconnect","SocketController","migrationLog_repository_1","StorageMigrationService","storageSrv","migrationLogRepository","migrations","migrationLogs","getMigrationLog","logs","success","migration_id","addMigrations","dbMigration","action","args","push","arr","migration","concat","callback","params","replace","arg","JSON","stringify","slice","__1","MigrationLogRepository","tableName","INTEGER","primaryKey","autoIncrement","notNull","STRING","TEXT","defaultValue","BOOLEAN","DATE_TIME","String"],"mappings":"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","file":"server.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","module.exports = require(\"reflect-metadata\");","module.exports = require(\"typedi\");","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Logger_service_1 = __importDefault(require(\"./Logger.service\"));\r\nexports.LoggerService = Logger_service_1.default;\r\nconst Setting_service_1 = __importDefault(require(\"./Setting.service\"));\r\nexports.SettingService = Setting_service_1.default;\r\nconst SocketManager_service_1 = __importDefault(require(\"./SocketManager.service\"));\r\nexports.SocketManagerService = SocketManager_service_1.default;\r\nconst Storage_service_1 = __importDefault(require(\"./Storage.service\"));\r\nexports.StorageService = Storage_service_1.default;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"reflect-metadata\");\r\n// System Services\r\nconst system_1 = require(\"./system\");\r\nexports.SettingService = system_1.SettingService;\r\nexports.StorageService = system_1.StorageService;\r\nexports.LoggerService = system_1.LoggerService;\r\nexports.SocketManagerService = system_1.SocketManagerService;\r\n","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/*\r\n    sqlite3 node libraries\r\n    ref: https://db-migrate.readthedocs.io/en/latest/API/SQL/#migrations-api-sql\r\n*/\r\nconst driver = require('db-migrate-sqlite3');\r\nconst { dataType } = require('db-migrate-shared');\r\nrequire(\"reflect-metadata\");\r\nconst typedi_1 = require(\"typedi\");\r\nconst _1 = require(\".\");\r\nconst events_1 = require(\"events\");\r\nlet StorageService = class StorageService extends events_1.EventEmitter {\r\n    constructor(logger, settingSrv) {\r\n        super();\r\n        this.logger = logger;\r\n        this.settingSrv = settingSrv;\r\n        this.logger.info('created StorageSrv');\r\n        this.dbname = this.settingSrv.getSystemDbName();\r\n    }\r\n    init() {\r\n        return new Promise((resolve, reject) => {\r\n            this.connect(this.dbname).then((db) => {\r\n                this.db = db;\r\n                this.logger.info(`Connected to the ${this.dbname} database.`);\r\n                resolve();\r\n            }, (error) => {\r\n                reject(error);\r\n            });\r\n        });\r\n    }\r\n    connect(dbname) {\r\n        this.logger.info(`try load sqlite : ${dbname}`);\r\n        this.logger['sql'] = this.sqlLogger.bind(this);\r\n        return new Promise((resolve, reject) => {\r\n            /* if not exist then create database file */\r\n            const internals = {\r\n                mod: {\r\n                    log: this.logger,\r\n                    type: dataType,\r\n                },\r\n                interfaces: {\r\n                    SeederInterface: {},\r\n                    MigratorInterfrace: {},\r\n                },\r\n            };\r\n            const val = { driver: 'sqlite3', filename: this.dbname };\r\n            driver.connect(val, internals, (err, db) => {\r\n                if (err) {\r\n                    reject(err);\r\n                }\r\n                else {\r\n                    db.all('PRAGMA foreign_keys=ON');\r\n                    resolve(db);\r\n                }\r\n            });\r\n        });\r\n    }\r\n    sqlLogger() {\r\n        /*\r\n        this.logger.debug(arguments[0], {\r\n          meta: {\r\n            __filename,\r\n            __function: (global as any).__function,\r\n            __line: (global as any).__line,\r\n          },\r\n        });\r\n        */\r\n    }\r\n};\r\nStorageService = __decorate([\r\n    typedi_1.Service(),\r\n    __metadata(\"design:paramtypes\", [_1.LoggerService,\r\n        _1.SettingService])\r\n], StorageService);\r\nexports.default = StorageService;\r\n","module.exports = require(\"events\");","module.exports = require(\"routing-controllers\");","module.exports = require(\"socket-controllers\");","module.exports = require(\"db-migrate-shared\");","\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst server_1 = __importDefault(require(\"./server\"));\r\nconst serv = new server_1.default(process.env.PORT);\r\nserv.runServ();\r\n","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"reflect-metadata\");\r\nrequire(\"./polyfills\");\r\nconst routing_controllers_1 = require(\"routing-controllers\");\r\nconst socket_controllers_1 = require(\"socket-controllers\");\r\nconst typedi_1 = require(\"typedi\");\r\nconst http_1 = __importDefault(require(\"http\"));\r\nconst express_1 = __importDefault(require(\"express\"));\r\nconst socket_io_1 = __importDefault(require(\"socket.io\"));\r\nconst morgan = require('morgan');\r\nconst figlet = require('figlet');\r\nconst cors = require('cors');\r\nconst path = require('path');\r\nrequire(\"./controllers\");\r\nconst services_1 = require(\"./services\");\r\nconst events_1 = require(\"events\");\r\nconst StorageMigration_service_1 = __importDefault(require(\"./services/system/StorageMigration.service\"));\r\nclass MainServer extends events_1.EventEmitter {\r\n    constructor(port) {\r\n        const rootPath = path.join('dist', 'public');\r\n        super();\r\n        /* setter */\r\n        routing_controllers_1.useContainer(typedi_1.Container);\r\n        socket_controllers_1.useContainer(typedi_1.Container);\r\n        /* create Server */\r\n        this.app = express_1.default();\r\n        this.app.use(cors());\r\n        /* set Html View Render */\r\n        this.app.engine('html', require('ejs').renderFile);\r\n        this.app.set('views', path.join(rootPath));\r\n        this.app.set('view engine', 'html');\r\n        routing_controllers_1.useExpressServer(this.app);\r\n        this.server = http_1.default.createServer(this.app);\r\n        this.app.use('/public', express_1.default.static(rootPath));\r\n        /* create websocket listener */\r\n        this.io = socket_io_1.default(this.server);\r\n        this.io.use((socket, next) => {\r\n            console.log('Custom middleware');\r\n            next();\r\n        });\r\n        console.log(__dirname);\r\n        socket_controllers_1.useSocketServer(this.io, {\r\n            controllers: [path.join(__dirname, 'controllers', 'websocket', '*.js')],\r\n        });\r\n        /* create System Logger */\r\n        const loggerSrv = typedi_1.Container.get(services_1.LoggerService);\r\n        loggerSrv.info(`\\n${figlet.textSync('Sample')}`);\r\n        /* register logger Service */\r\n        this.app.use(morgan('combined', { stream: loggerSrv }));\r\n        /* register service instance */\r\n        this.addServices();\r\n        this.port = port ? parseInt(port, 10) : typedi_1.Container.get(services_1.SettingService).getPort();\r\n    }\r\n    addMiddleware(middleware) {\r\n        this.app.use(middleware);\r\n    }\r\n    addServices() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const etcInstances = [\r\n                { name: 'socketIO', instance: this.io },\r\n            ];\r\n            const loggerSrv = typedi_1.Container.get(services_1.LoggerService);\r\n            for (const { name, instance } of etcInstances) {\r\n                typedi_1.Container.set(name, instance);\r\n                loggerSrv.info(`[init] DI Registered ${name}`);\r\n            }\r\n            const registerServices = [\r\n                /* System Services */\r\n                services_1.SettingService,\r\n                services_1.StorageService,\r\n                StorageMigration_service_1.default,\r\n                services_1.SocketManagerService,\r\n            ];\r\n            // register system services\r\n            for (const service of registerServices) {\r\n                try {\r\n                    const instance = typedi_1.Container.get(service);\r\n                    yield instance.init();\r\n                    loggerSrv.info(`[Serivce Initialize] DI Registered ${service.name}`);\r\n                }\r\n                catch (e) {\r\n                    console.log(e.stack);\r\n                    loggerSrv.error(e);\r\n                }\r\n            }\r\n            this.emit('ready');\r\n        });\r\n    }\r\n    getApp() {\r\n        return this.app;\r\n    }\r\n    runServ() {\r\n        const loggerSrv = typedi_1.Container.get(services_1.LoggerService);\r\n        return new Promise((resolve) => {\r\n            this.once('ready', () => {\r\n                resolve(this.server.listen(this.port, () => loggerSrv.info(`listening on port ${this.port}`)));\r\n            });\r\n        });\r\n    }\r\n}\r\nexports.default = MainServer;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/** reflect-metadata **/\r\nrequire(\"reflect-metadata\");\r\n","module.exports = require(\"http\");","module.exports = require(\"express\");","module.exports = require(\"socket.io\");","module.exports = require(\"morgan\");","module.exports = require(\"figlet\");","module.exports = require(\"cors\");","module.exports = require(\"path\");","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"./rest/RootController\");\r\nrequire(\"./websocket/WsMessageController\");\r\n","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"reflect-metadata\");\r\nconst routing_controllers_1 = require(\"routing-controllers\");\r\nconst services_1 = require(\"../../services\");\r\nlet RootController = class RootController {\r\n    constructor(loggerSrv) {\r\n        this.loggerSrv = loggerSrv;\r\n        this.loggerSrv.info('created RootController');\r\n    }\r\n    helloServer() {\r\n    }\r\n    getApi() {\r\n        return [\r\n            { hello: 'Hello Node.js Express Server' },\r\n        ];\r\n    }\r\n};\r\n__decorate([\r\n    routing_controllers_1.Get('/'),\r\n    routing_controllers_1.Render('index.html'),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", []),\r\n    __metadata(\"design:returntype\", void 0)\r\n], RootController.prototype, \"helloServer\", null);\r\n__decorate([\r\n    routing_controllers_1.Get('/api'),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", []),\r\n    __metadata(\"design:returntype\", void 0)\r\n], RootController.prototype, \"getApi\", null);\r\nRootController = __decorate([\r\n    routing_controllers_1.Controller(''),\r\n    __metadata(\"design:paramtypes\", [services_1.LoggerService])\r\n], RootController);\r\nexports.RootController = RootController;\r\n","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"reflect-metadata\");\r\nconst winston_1 = require(\"winston\");\r\nconst typedi_1 = require(\"typedi\");\r\nlet LoggerService = class LoggerService {\r\n    constructor() {\r\n        this.logger = winston_1.createLogger({\r\n            // level: 'info',\r\n            format: winston_1.format.combine(winston_1.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }), winston_1.format((info) => {\r\n                if (info.level === 'error') {\r\n                    return Object.assign({}, info, {\r\n                        message: `${info.timestamp} ${info.stack}`,\r\n                    });\r\n                }\r\n                return info;\r\n            })(), winston_1.format.printf(({ timestamp, level, message, meta }) => (meta)\r\n                ? `${timestamp} ${level} [${meta.filename}:${meta.line}]: ${message}`\r\n                : `${timestamp} ${level} ${message}`)),\r\n            transports: [\r\n                new winston_1.transports.Console({ level: 'debug', handleExceptions: true }),\r\n                new winston_1.transports.File({ filename: 'error.log', level: 'error' }),\r\n                new winston_1.transports.File({ filename: 'system.log' }),\r\n            ],\r\n            exitOnError: false,\r\n        });\r\n    }\r\n    init() {\r\n        this.logger.info('created LoggerSrv');\r\n    }\r\n    write(message, encoding) { this.logger.info(message); }\r\n    alert(msg, index = 3) { this.logger.alert(msg); }\r\n    crit(msg, index = 3) { this.logger.crit(msg); }\r\n    data(msg, index = 3) { this.logger.data(msg); }\r\n    debug(msg, index = 3) { this.logger.debug(msg); }\r\n    error(msg, index = 3) { this.logger.error(msg); }\r\n    help(msg, index = 3) { this.logger.help(msg); }\r\n    input(msg, index = 3) { this.logger.input(msg); }\r\n    info(msg, index = 3) { this.logger.info(msg); }\r\n    log(level, msg, index = 3) { this.logger.log(level, msg); }\r\n    notice(msg, index = 3) { this.logger.notice(msg); }\r\n    sql(msg, index = 3) { this.debug(msg, index); }\r\n    prompt(msg, index = 3) { this.logger.prompt(msg); }\r\n    silly(msg, index = 3) { this.logger.silly(msg); }\r\n    verbose(msg, index = 3) { this.logger.verbose(msg); }\r\n    warn(msg, index = 3) { this.logger.warn(msg); }\r\n    warning(msg, index = 3) { this.logger.warning(msg); }\r\n};\r\nLoggerService = __decorate([\r\n    typedi_1.Service(),\r\n    __metadata(\"design:paramtypes\", [])\r\n], LoggerService);\r\nexports.default = LoggerService;\r\n","module.exports = require(\"winston\");","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"reflect-metadata\");\r\nconst typedi_1 = require(\"typedi\");\r\nconst _1 = require(\".\");\r\nlet SettingService = class SettingService {\r\n    constructor(logger) {\r\n        this.logger = logger;\r\n        this.logger.info('created SettingSrv');\r\n        this.settings = this.loadSettingFile();\r\n    }\r\n    init() {\r\n        return Promise.resolve();\r\n    }\r\n    /**\r\n     * Create a `uid`\r\n     *\r\n     * @param { Number } len\r\n     * @return { String } uid\r\n     */\r\n    uid(len) {\r\n        // create uuid\r\n        len = len || 7;\r\n        return Math.random().toString(35).substr(2, len);\r\n    }\r\n    loadSettingFile() {\r\n        const config = require('../../config/config.json');\r\n        return config;\r\n    }\r\n    getPort() {\r\n        return this.settings['port'];\r\n    }\r\n    getSystemDbName() {\r\n        return this.settings.sqlite;\r\n    }\r\n    getSettings() {\r\n        return this.settings;\r\n    }\r\n};\r\nSettingService = __decorate([\r\n    typedi_1.Service(),\r\n    __metadata(\"design:paramtypes\", [_1.LoggerService])\r\n], SettingService);\r\nexports.default = SettingService;\r\n","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"reflect-metadata\");\r\nconst typedi_1 = require(\"typedi\");\r\nconst _1 = require(\".\");\r\nlet SocketManagerService = class SocketManagerService {\r\n    constructor(logger) {\r\n        this.logger = logger;\r\n        this.sockets = {};\r\n        this.logger.info('created SocketMangerSrv');\r\n    }\r\n    init() {\r\n        return Promise.resolve();\r\n    }\r\n    addSocket(socket) {\r\n        const { id } = socket;\r\n        this.sockets[id] = socket;\r\n        this.logger.info(`registerd ${id}`);\r\n    }\r\n    delSocket(id) {\r\n        this.logger.info(`unregisterd ${id}`);\r\n        delete this.sockets[id];\r\n    }\r\n    getSocket(id) {\r\n        return this.sockets[id];\r\n    }\r\n    isExistSocket(id) {\r\n        return !!this.sockets[id];\r\n    }\r\n    getAll() {\r\n        return this.sockets;\r\n    }\r\n    emitAll(event, message) {\r\n        for (const id in this.sockets) {\r\n            const socket = this.sockets[id];\r\n            socket.emit(event, message);\r\n        }\r\n    }\r\n};\r\nSocketManagerService = __decorate([\r\n    typedi_1.Service(),\r\n    __metadata(\"design:paramtypes\", [_1.LoggerService])\r\n], SocketManagerService);\r\nexports.default = SocketManagerService;\r\n","module.exports = require(\"db-migrate-sqlite3\");","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst socket_controllers_1 = require(\"socket-controllers\");\r\nconst services_1 = require(\"../../services\");\r\nlet WsMessageController = class WsMessageController {\r\n    constructor(sockMgrSrv, loggerSrv) {\r\n        this.sockMgrSrv = sockMgrSrv;\r\n        this.loggerSrv = loggerSrv;\r\n        this.loggerSrv.info('created WsMessageController');\r\n    }\r\n    connection(socket) {\r\n        this.sockMgrSrv.addSocket(socket);\r\n        this.loggerSrv.info('client connected');\r\n    }\r\n    disconnect(socket) {\r\n        const { id } = socket;\r\n        this.sockMgrSrv.delSocket(id);\r\n    }\r\n};\r\n__decorate([\r\n    socket_controllers_1.OnConnect(),\r\n    __param(0, socket_controllers_1.ConnectedSocket()),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", [Object]),\r\n    __metadata(\"design:returntype\", void 0)\r\n], WsMessageController.prototype, \"connection\", null);\r\n__decorate([\r\n    socket_controllers_1.OnDisconnect(),\r\n    __param(0, socket_controllers_1.ConnectedSocket()),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", [Object]),\r\n    __metadata(\"design:returntype\", void 0)\r\n], WsMessageController.prototype, \"disconnect\", null);\r\nWsMessageController = __decorate([\r\n    socket_controllers_1.SocketController('/ws'),\r\n    __metadata(\"design:paramtypes\", [services_1.SocketManagerService,\r\n        services_1.LoggerService])\r\n], WsMessageController);\r\nexports.WsMessageController = WsMessageController;\r\n","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"reflect-metadata\");\r\nconst typedi_1 = require(\"typedi\");\r\nconst events_1 = require(\"events\");\r\nconst migrationLog_repository_1 = __importDefault(require(\"./repositories/migrationLog.repository\"));\r\nconst Storage_service_1 = __importDefault(require(\"./Storage.service\"));\r\nconst _1 = require(\".\");\r\nlet StorageMigrationService = class StorageMigrationService extends events_1.EventEmitter {\r\n    constructor(logger, storageSrv, \r\n    /* sqlite3 table reposiotries */\r\n    migrationLogRepository) {\r\n        super();\r\n        this.logger = logger;\r\n        this.storageSrv = storageSrv;\r\n        this.migrationLogRepository = migrationLogRepository;\r\n        this.migrations = [];\r\n        this.logger.info('created StorageMigrationSrv');\r\n    }\r\n    init() {\r\n        const migrationLogs = {};\r\n        return this.migrationLogRepository.getMigrationLog().then((logs) => {\r\n            for (const log of logs) {\r\n                if (log.success) {\r\n                    migrationLogs[log.migration_id] = log;\r\n                }\r\n            }\r\n            return migrationLogs;\r\n        }).then((migrationLogs) => {\r\n            this.addMigrations();\r\n            this.dbMigration(migrationLogs);\r\n        });\r\n    }\r\n    // tslint:disable-next-line: variable-name\r\n    addMigration(migration_id, action, args) {\r\n        this.migrations.push({ migration_id, action, args });\r\n    }\r\n    addMigrations() {\r\n        const arr = [\r\n            this.migrationLogRepository.migrations(),\r\n        ];\r\n        for (const migration of arr) {\r\n            this.migrations = this.migrations.concat(migration);\r\n        }\r\n    }\r\n    dbMigration(migrationLogs) {\r\n        for (const { migration_id, action, args } of this.migrations) {\r\n            if (!migrationLogs[migration_id]) {\r\n                this.logger.info(`execute ${migration_id}`);\r\n                /* change callback function */\r\n                const callback = args[args.length - 1];\r\n                args[args.length - 1] = (...params) => {\r\n                    const [err] = params;\r\n                    const success = !err ? true : false;\r\n                    /* double quatation     */\r\n                    const error = err ? err.message.replace(/\\\"/gi, \"'\") : '';\r\n                    const arg = JSON.stringify(args.slice(0, args.length - 1)).replace(/\\\"/gi, \"'\");\r\n                    /* write migration_log */\r\n                    this.storageSrv.db['insert']('migration_log', ['migration_id', 'action', 'success', 'error', 'params'], [migration_id, action, success, error, arg], (err) => {\r\n                        if (err) {\r\n                            this.logger.error(err);\r\n                        }\r\n                    });\r\n                    callback.apply(this.storageSrv.db, params);\r\n                };\r\n                try {\r\n                    this.storageSrv.db[action].apply(this.storageSrv.db, args);\r\n                }\r\n                catch (err) {\r\n                    this.logger.error(err);\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\nStorageMigrationService = __decorate([\r\n    typedi_1.Service(),\r\n    __metadata(\"design:paramtypes\", [_1.LoggerService,\r\n        Storage_service_1.default,\r\n        migrationLog_repository_1.default])\r\n], StorageMigrationService);\r\nexports.default = StorageMigrationService;\r\n","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nrequire(\"reflect-metadata\");\r\nconst typedi_1 = require(\"typedi\");\r\nconst Storage_service_1 = __importDefault(require(\"../Storage.service\"));\r\nconst __1 = require(\"..\");\r\nconst { dataType } = require('db-migrate-shared');\r\nlet MigrationLogRepository = class MigrationLogRepository {\r\n    constructor(logger, storageSrv) {\r\n        this.logger = logger;\r\n        this.storageSrv = storageSrv;\r\n        this.tableName = 'migration_log';\r\n        this.logger.info('created Migration_logRepository');\r\n    }\r\n    init() {\r\n        return Promise.resolve();\r\n    }\r\n    /* ref: https://db-migrate.readthedocs.io/en/latest/API/SQL/#migrations-api-sql */\r\n    migrations() {\r\n        return [{\r\n                migration_id: 'create table migration_log',\r\n                action: 'createTable',\r\n                args: [this.tableName, {\r\n                        id: { type: dataType.INTEGER,\r\n                            primaryKey: true, autoIncrement: true, notNull: true },\r\n                        migration_id: { type: dataType.STRING, length: 255 },\r\n                        action: { type: dataType.STRING, notNull: true, length: 20 },\r\n                        params: { type: dataType.TEXT, notNull: true, defaultValue: '' },\r\n                        success: { type: dataType.BOOLEAN, notNull: true },\r\n                        error: { type: dataType.TEXT, defaultValue: '' },\r\n                        // tslint:disable-next-line: no-construct\r\n                        timestamp: { type: dataType.DATE_TIME, defaultValue: new String('CURRENT_TIMESTAMP') },\r\n                    },\r\n                    (err) => {\r\n                        if (err) {\r\n                            this.logger.error(err);\r\n                        }\r\n                    }],\r\n            },\r\n        ];\r\n    }\r\n    getMigrationLog() {\r\n        return new Promise((resolve) => {\r\n            const { db } = this.storageSrv;\r\n            db['all']('select * from migration_log', (err, logs) => {\r\n                if (err) {\r\n                    resolve([]);\r\n                }\r\n                else {\r\n                    resolve(logs);\r\n                }\r\n            });\r\n        });\r\n    }\r\n};\r\nMigrationLogRepository = __decorate([\r\n    typedi_1.Service(),\r\n    __metadata(\"design:paramtypes\", [__1.LoggerService,\r\n        Storage_service_1.default])\r\n], MigrationLogRepository);\r\nexports.default = MigrationLogRepository;\r\n","module.exports = require(\"ejs\");"],"sourceRoot":""}